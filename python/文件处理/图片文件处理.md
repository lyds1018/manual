# 📂 Python 处理图片文件

## 1. 使用 Pillow

### (1) 打开与保存图片

```
from PIL import Image

# 打开
img = Image.open("test.jpg")
img.show()

# 保存
img.save("output.png")
```

------

### (2) 获取基本信息

```
print(img.format)   # JPEG
print(img.size)     # (宽, 高)
print(img.mode)     # RGB, L(灰度), RGBA
```

------

### (3) 基础操作

```
# 转换格式
gray = img.convert("L")     # 转灰度图
gray.save("gray.jpg")

# 缩放
resized = img.resize((200, 200))
resized.save("resize.jpg")

# 裁剪
box = (50, 50, 200, 200)    # (x1, y1, x2, y2)
cropped = img.crop(box)
cropped.save("crop.jpg")

# 旋转/翻转
rotated = img.rotate(45)    # 旋转45度
flipped = img.transpose(Image.FLIP_LEFT_RIGHT)  # 水平翻转
```

------

### (4) 绘图与文字

```
from PIL import ImageDraw, ImageFont

draw = ImageDraw.Draw(img)
draw.line((0, 0, 100, 100), fill="red", width=3)
font = ImageFont.load_default()
draw.text((10, 10), "Hello", fill="blue", font=font)
img.save("draw.jpg")
```

------

## 2. 使用 OpenCV

### (1) 读写图像

```
import cv2

img = cv2.imread("test.jpg")      # 读取(BGR格式)
cv2.imwrite("output.png", img)    # 保存
```

------

### (2) 显示图像

```
cv2.imshow("window", img)
cv2.waitKey(0)      # 等待按键
cv2.destroyAllWindows()
```

------

### (3) 基础操作

```
# 转换通道
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)	# 灰度图
gray = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)	    # RGB通道

# 缩放
resized = cv2.resize(img, (200, 200))

# 裁剪（直接用数组切片）
crop = img[50:200, 50:200]    # [50-199行, 50-199列]

# 旋转
(h, w) = img.shape[:2]
M = cv2.getRotationMatrix2D((w/2, h/2), 45, 1.0)
rotated = cv2.warpAffine(img, M, (w, h))

# 翻转
flipped = cv2.flip(img, 1)  # 1水平, 0垂直, -1水平+垂直
```

------

### (4) 绘制图形和文字

```
cv2.line(img, (0, 0), (100, 100), (0, 0, 255), 3)
cv2.rectangle(img, (50, 50), (150, 150), (255, 0, 0), 2)
cv2.putText(img, "Hello", (10, 30), cv2.FONT_HERSHEY_SIMPLEX, 
            1, (0, 255, 0), 2)
```

------

### (5) 图像处理

```
# 高斯模糊
blur = cv2.GaussianBlur(img, (5, 5), 0)

# 边缘检测
edges = cv2.Canny(img, 100, 200)

# 二值化
ret, thresh = cv2.threshold(gray, 127, 255, cv2.THRESH_BINARY)
```